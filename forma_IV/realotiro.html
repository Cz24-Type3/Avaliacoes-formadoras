<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--Inserindo o bootstrap-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <title>Formul√°rio</title>
    <link href="css.css" rel="stylesheet" />
  </head>
  <body>
    <!--Cabe√ßalho-->
    <div style="background-color: #131313">
      <!--Logo + link-->
      <a href="index.html"
        ><img src="simbolo.png" style="width: 6.8%; margin-right: 89%"
      /></a>
    </div>

    <!--Relat√≥rio-->
    <div class="container mt-4" style="color:white;">

    <h2>üìÑ Relat√≥rio de A√ß√µes no Estoque</h2>

    <div id="totais" class="mt-4"></div>

    <h3 class="mt-5">Hist√≥rico Completo</h3>
    <table class="table table-dark table-striped mt-3">
        <thead>
            <tr>
                <th>ID Log</th>
                <th>ID da Ferramenta</th>
                <th>A√ß√£o</th>
                <th>Data/Hora</th>
            </tr>
        </thead>
        <tbody id="tabela-logs"></tbody>
    </table>

    <button id="btnPDF">Exportar relat√≥rio em PDF</button>

</div>

  <!--Script para gerar o relat√≥ri-->
  <script>
    fetch("relatorio.php")
        .then(res => res.json())
        .then(dados => {

            // Totais
            document.getElementById("totais").innerHTML = `
                <p><strong>Total de a√ß√µes:</strong> ${dados.totais.total}</p>
                <p><strong>Adicionados:</strong> ${dados.totais.adicionados}</p>
                <p><strong>Removidos:</strong> ${dados.totais.removidos}</p>
            `;

            // Lista
            let tabela = "";
            dados.lista.forEach(l => {
                tabela += `
                    <tr>
                        <td>${l.logfeid}</td>
                        <td>${l.id}</td>
                        <td>${l.acao}</td>
                        <td>${l.feito_em}</td>
                    </tr>
                `;
            });

            document.getElementById("tabela-logs").innerHTML = tabela;
        });
</script>

<!--Script para gerar o PDF-->
  <script>
document.getElementById("btnPDF").addEventListener("click", function () {

    // Verifica se j√° tem tabela carregada
    const tabela = document.querySelector(".table-dark");
    if (!tabela) {
        alert("Nenhuma ferramenta foi consultada ainda.");
        return;
    }

    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.text("Relat√≥rio de Ferramentas", 14, 15);

    doc.autoTable({
        html: tabela,
        startY: 20,
        theme: 'grid'
    });

    doc.save("relatorio_ferramentas.pdf");
});
</script>

    <!--Rodap√©-->
    <div id="rodape">
        <a href="https://github.com/Cz24-Type3" style="align-content: center; margin-left: 34%; color:white;">GitHub</a>
        <a href="#" style="align-content: center; margin-left: 20%; color:white;">Mais informa√ß√µes</a>
    </div>
    <script src="js.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</body>
<script src="js.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</html>
